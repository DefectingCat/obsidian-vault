## 即构的流程

设置用户信息以及登录 token，并将其 dispatch 到全局状态中，随后再调用即构的设置房间状态的方法，会将用于登录到即构的 token 更新到全局状态。

```ts
dispatch(
  updateRoom({
    userName: '游客',
    character: 'jueseA_Ani',
  })
);
await getZegoAppID();
await getRoomState(boothID, whatToken);
```

在即构中，房间状态的 token 的更新会直接触发重新登录房间。

```ts
// 根据zege slice 状态自动登录
useEffect(() => {
  loginRoom();
  // eslint-disable-next-line react-hooks/exhaustive-deps
}, [roomState.roomID, roomState.token]);
```

即构成功登录到房间后，其他用户进入以及离开房间都会通过即构的消息 `roomUserUpdate` 获得通知。

### 对方进入房间后

当对方进入房间房间触发了 `roomUserUpdate` 后，就立即通过发送私聊消息来获取对方的信息，并添加到人物列表。

```ts
// 监听对方进入房间
zg?.on('roomUserUpdate', (_roomID, updateType, userNewList) => {
  if (updateType === 'ADD') {
    // TODO: 等待对方回复了私聊消息后再添加到人物列表
    dispatch(
      updateUsers({
        users: userNewList,
        type: 'add',
      })
    );
    // 进入房间时更新对方角色信息
    const updateChar: DirectMessage = {
      type: 'update',
      data: {
        character: true,
        position: true,
      },
    };
    dispatch(
      sendCustomCommand(
        userNewList.map((u) => u.userID),
        updateChar
      )
    );
  }
  if (updateType === 'DELETE') {
    dispatch(
      updateUsers({
        users: userNewList,
        type: 'remove',
      })
    );
  }
});
```
