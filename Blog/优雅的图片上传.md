在默认情况下，如果将一个图片拖放到浏览器中则会直接在标签页中打开它。

HTML 最早的用途就是表单（Forms），早在没有 JavaScript 时表单就已经成为主流应用。JavaScript 的最早用途也就是为了避免在服务端验证表单的繁琐操作。

在最新的 HTML 标准中，`<input />` 标签光 `type` 属性就高达[十几种](https://www.w3schools.com/html/html_form_input_types.asp)，满足了多种表单控件的需要。

* `<input type="button">`
* `<input type="checkbox">`
* `<input type="color">`
* `<input type="date"> `
* `<input type="datetime-local">`
* `<input type="email">`
* `<input type="file"> `
* ……

而文件的上传，或者说 DOM API 通过浏览器与系统本地文件交互最常见的方式就是通过 `<input type="file" />`。

```html
<input type="file" />
```

点击“选择文件”就会打开熟悉的系统文件选择界面（在 Windows 上则是 explorer）：

![[Pasted image 20230106105257.png]]

默认控件有一点好处就是它的文字提示会随着浏览器而本地化（就是“选择文件”那几个字）。

默认的控件虽然不是非常的好看，还可能随着浏览器的不同而出现样式的不同。但它却是不可缺少的 API 之一。

不过好在我们有 CSS 可以拯救它。

## 样式化

由于 `type="file"` 控件的默认样式比较复杂，它由两个部分组成：一个点击的按钮和已经选择的文件名称。

要通过 CSS 来修改其默认的样式，目前还没有一个通用的标准，常见的修改方式有：

* 隐藏 input 标签，通过 label 标签来触发点击；
* 使用 `::before` 伪元素；
* 隐藏 input 标签，使用 JavaScript 来触发点击；

它们的核心思想基本都是通过将默认的 input 标签样式隐藏，随后使用其他方式创建新的样式，再将用户的点击同时触发到 input 标签上。从而实现对 `type="file"` 的自定义。

除此之外，[tailwindcss](https://tailwindcss.com/docs/hover-focus-and-other-states#file-input-buttons) 还有个 `file:` 修饰符可以用来修改默认控件的样式，而且和上述方法不同的是它是直接修改的 input 标签本身，目前还没发现是如何实现的。

对于我们自己实现，自然是直接隐藏 input 标签更加方便快捷。且大部分情况下默认控件自带的显示已选择文件名称的部分我们也不需要。

最佳解决办法就是利用 label 标签的特性，先将 input 标签隐藏，再配合 label 标签来实现对 input 标签的点击。不需要 JavaScript 即可完成这一操作。

```html
<style>
  .input {
    display: none;
  }
</style>

<input class="input" type="file" id="image-upload" />
<label for="image-upload">
  Choose file
</label>
```

> Attribute `id="image-upload"` 的 id 需要保持在整个文档中的唯一性。

那么它的缺点是什么呢？没错，这种方式不能配合 button 标签使用。将 `<button>Choose file</button>` 放置在 label 中则无法像上述一样生效

```html
<style>
  .input {
    display: none;
  }

  .fancy-btn {
    align-items: center;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: transparent 0 0 0 3px, rgba(18, 18, 18, .1) 0 6px 20px;
    box-sizing: border-box;
    color: #121212;
    cursor: pointer;
    display: inline-flex;
    flex: 1 1 auto;
    font-family: Inter, sans-serif;
    font-size: 1.2rem;
    font-weight: 700;
    justify-content: center;
    line-height: 1;
    margin: 0;
    outline: none;
    padding: 1rem 1.2rem;
    text-align: center;
    text-decoration: none;
    transition: box-shadow .2s, -webkit-box-shadow .2s;
    white-space: nowrap;
    border: 0;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
  }

  .fancy-btn:hover {
    box-shadow: #121212 0 0 0 3px, transparent 0 0 0 0;
  }
</style>

<input class="input" type="file" id="image-upload" />
<label for="image-upload">
  <button class="fancy-btn">
    Choose file
  </button>
</label>
```

暂时没找到为什么，如果需要 button 标签，那就只能利用 JavaScript 来解决问题了。

```html
<input class="input" type="file" id="image-upload" />
<label for="image-upload">
  <button class="fancy-btn">Choose file</button>
</label>

<script>
  const btn = document.querySelector('.fancy-btn');
  const input = document.querySelector('#image-upload');

  btn?.addEventListener('click', (e) => {
    e.preventDefault();
    input?.click();
  });
</script>
```

这里使用的是最基本的 JavaScript 操作，分别获取的 button 和 input 的 DOM。然后再监听 button 的 `click` 事件，当触发时，通过 DOM API 来主动触发 input 的点击事件。也就是 `input.click()`。

## 获取选择的文件

没错，和 `type="text"` 时一样，获取到 input 的操作的对象最佳办法就是监听其 `change` 事件。回调函数所接受的参数事件对象就是我们与其沟通的桥梁。

```js
input?.addEventListener('change', (e) => {
  console.log(e.target.files);
});
```

不过与 `type="text"` 不同的时，用户选择的文件并不在 `e.target.value` 这个属性上，而是在 `e.target.files`。无论是否启用了多选，`files` 这个属性始终是一个类数组。是的，该对象 `FileList` 并非继承自 `Array` 对象，而是由 `FileList` 构建出来的。

```
FileList {0: File, length: 1, item: ƒ item(), constructor: Object}
0: File
length: 1
item: ƒ item() {}
<constructor>: "FileList"
```

无论它是否继承自真正的 `Array` 对象，都不影响我们获取用户刚选择的文件。该对象中保存的 `File` 对象就包含用户选择的文件所有的信息（我们能获取到的所有的信息